<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>MK Electric CAD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- NUEVO ENLACE DE LIBRERÍA MÁS ESTABLE -->
    <script src="https://cdnjs.cloudflare.com"></script>
</head>
<body class="bg-[#1a2233] text-slate-300 overflow-hidden">

    <header class="h-16 bg-[#111827] flex items-center justify-between px-6 border-b border-slate-800">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center font-bold text-yellow-500 text-xl">MK</div>
            <h1 class="font-bold text-white tracking-widest uppercase">MK Electric CAD</h1>
        </div>
        <button onclick="limpiar()" class="bg-red-600 hover:bg-red-500 px-4 py-1 rounded text-xs text-white font-bold transition">Limpiar Todo</button>
    </header>

    <main class="flex h-[calc(100vh-64px)]">
        <!-- Izquierda: Componentes -->
        <aside class="w-64 bg-[#111827] p-4 border-r border-slate-800 space-y-6 overflow-y-auto">
            <section>
                <h2 class="text-[10px] text-slate-500 font-bold uppercase mb-3">Protecciones REBT</h2>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="crearPieza('IGA', '#ef4444')" class="bg-slate-800 p-2 rounded text-[10px] hover:bg-slate-700">IGA</button>
                    <button onclick="crearPieza('ID', '#f59e0b')" class="bg-slate-800 p-2 rounded text-[10px] hover:bg-slate-700">ID</button>
                    <button onclick="crearPieza('LUZ (C1)', '#3b82f6')" class="bg-blue-900/50 p-2 rounded text-[10px] hover:bg-blue-800">LUZ (C1)</button>
                    <button onclick="crearPieza('TOMA (C2)', '#10b981')" class="bg-green-900/50 p-2 rounded text-[10px] hover:bg-green-800">TOMA (C2)</button>
                </div>
            </section>

            <section>
                <h2 class="text-[10px] text-slate-500 font-bold uppercase mb-3">Cableado (Colores)</h2>
                <button onclick="crearCable('#92400e')" class="w-full bg-amber-900/30 border border-amber-700 p-2 rounded text-[10px] text-left mb-2">Fase (Marrón)</button>
                <button onclick="crearCable('#1e40af')" class="w-full bg-blue-900/30 border border-blue-700 p-2 rounded text-[10px] text-left mb-2">Neutro (Azul)</button>
                <button onclick="crearCable('#166534')" class="w-full bg-green-900/30 border border-green-700 p-2 rounded text-[10px] text-left">Tierra (Verde/Amar.)</button>
            </section>
        </aside>

        <!-- Centro: Canvas -->
        <section class="flex-1 p-8 flex justify-center items-center">
            <canvas id="canvas_electrico" class="rounded shadow-2xl"></canvas>
        </section>

        <!-- Derecha: Arquitectura -->
        <aside class="w-64 bg-[#111827] p-4 border-l border-slate-800">
            <h2 class="text-[10px] text-slate-500 font-bold uppercase mb-3 font-bold uppercase">Arquitectura</h2>
            <button onclick="crearPared()" class="w-full bg-slate-800 p-2 rounded text-[10px] hover:bg-slate-700">Dibujar Pared (m)</button>
        </aside>
    </main>

    <script>
        // Inicialización segura del lienzo
        let canvas;
        window.onload = function() {
            canvas = new fabric.Canvas('canvas_electrico', {
                width: 800,
                height: 600,
                backgroundColor: '#ffffff'
            });
        };

        function crearPieza(texto, color) {
            const rect = new fabric.Rect({ width: 60, height: 40, fill: color, rx: 5 });
            const label = new fabric.Text(texto, { fontSize: 12, fill: '#fff', left: 10, top: 12, fontWeight: 'bold' });
            const grupo = new fabric.Group([rect, label], { left: 50, top: 50 });
            canvas.add(grupo);
            canvas.setActiveObject(grupo);
        }

        function crearCable(color) {
            const cable = new fabric.Line([50, 50, 200, 50], {
                stroke: color,
                strokeWidth: 4,
                strokeLineCap: 'round'
            });
            canvas.add(cable);
        }

        function crearPared() {
            const pared = new fabric.Rect({
                left: 100, top: 100, width: 200, height: 10, fill: '#334155'
            });
            canvas.add(pared);
        }

        function limpiar() {
            canvas.clear();
            canvas.backgroundColor = '#ffffff';
            canvas.renderAll();
        }
    </script>
</body>
</html>
